<section class="grey-box" id="high-school">
<div class="container">
  <div class="row pt-4 pb-4">
      <div class="col-lg-12">
        <h2 class="home-header" style="padding-bottom:0; font-weight:700">Full Course Listings</h2>
        <h3 class="home-subheader"><b>Registration Opens February 15th!</b></h3>
        <p class="lead">Our full course list can be found below. Click "View Course Description" to learn more!</p>
      </div>
  </div>

  <div class="row pt-4 pb-4">

    <div class="col-lg-3">
      <div class="border-2 p-2 bg-white">
        <!--<label for="course_name"><b>Course name:</b></label>
        <input type="text" id="course_name" name="course_name">-->

        <p class="lead mb-1"><b>Course Type:</b></p>
        <label><input type="checkbox" name="courseType" value="on-campus"/> On-Campus</label><br>
        <label><input type="checkbox" name="courseType" value="virtual"/> Virtual</label><br>
        <p class="lead mb-1"><b>Subject Area:</b></p>
        {{ taxonomy:subject_area }}
          <label><input type="checkbox" name="subjectArea" value="{{ title }}" /> {{ title }}</label><br>
        {{ /taxonomy:subject_area }}
        <p class="lead mb-1"><b>Grade Level:</b></p>
        <label><input type="checkbox" name="gradeLevel" value="middle-school"/> Middle School</label><br>
        <label><input type="checkbox" name="gradeLevel" value="high-school"/> High School</label><br>
      </div>
    </div>

    <div class="col-lg-9 scrollBox">
    <section class="cards">
    {{ collection:courses }}

      <section id="{{slug}}" class="mt-1 mb-1 w-full" name="Courses" courseType="{{course_type}}{{title}}{{/course_type}}" subjectArea="{{subject_area}}{{title}}{{/subject_area}}" gradeLevel="{{grade_level}}{{title}}{{/grade_level}}">
      <article class="h-full border border-black light-background">
        <div class="card__inner">
        	<div class="container" style="padding:0">
        	  <div class="row">
        	  	<div class="col-lg-12">
	          	  <div class="col-lg-8 btn-container" style="text-align:left;padding-left:0">
		          		<p class="card__topic">{{course_type}}{{title}}{{/course_type}}</p>
          				<h3 class="card__title">{{ title }}</h3>
		      		  </div>
		         	  <div class="col-lg-4 btn-container">
						<a data-toggle="collapse" href="#collapse-college-{{slug}}" class="btn btn-outline-purple btn-text-large m-2">+ Course Description</a>
		         	</div>
                </div>
                <div class="col-lg-12">
                    <div id="collapse-college-{{slug}}" class="collapse">
                        <div class="container" style="padding:0">
                          <div class="row">
                            <div class="col-lg-12">
								<div class="col-lg-4 btn-container">
					          		<p class="card__text"><b>Dates:</b> {{dates}}{{title}}{{/dates}}</p>
					      		</div>
			                    <div class="col-lg-4 btn-container">
									<p class="card__text"><b>Grades:</b> {{grade_level}}{{title}}{{/grade_level}}</p>
					         	</div>
					         	<div class="col-lg-4 btn-container">
									<p class="card__text"><b>Tuition:</b> {{tuition}}{{title}}{{/tuition}}</p>
					         	</div>
                            <div class="col-lg-12">
                              <p class="card__body">
                              {{ content }}
                              </p>
                          </div>
                        </div>

                    </div>
	          	</div>
	      	  </div>
      		</div>
          </div>
      </article>
    </section>
      {{ /collection:courses }}
  </section>

    </div>
  </div>

</div>
</section>

<script>
  //This script filters the course list based on checkbox selections
  var checkboxes = document.querySelectorAll("input[type=checkbox]");
  var courses = Array.from(document.querySelectorAll("section[name=Courses]"));
  var checked = {};

  getChecked('courseType');
  getChecked('subjectArea');
  getChecked('gradeLevel');

  Array.prototype.forEach.call(checkboxes, function (el) {
  	el.addEventListener('change', toggleCheckbox);
  });

  function intersection(first, second)
  {
      var s = new Set(second);
      return first.filter(item => s.has(item));
  };

  function toggleCheckbox(e) {
    getChecked(e.target.name);
    setVisibility();
  }

  function getChecked(name) {
    checked[name] = Array.from(document.querySelectorAll('input[name=' + name + ']:checked')).map(function (el) {
      return el.value;
    });
  }

  function setVisibility() {
    courses.map(function (el) {
      //Parse course type (ie, "On-Campus Academy" -> "on-campus")
      courseTypeRaw = el.getAttribute('courseType')
      if (courseTypeRaw.includes("On-Campus")) {
        courseTypeParsed = "on-campus"
      }
      else if (courseTypeRaw.includes("Virtual")) {
        courseTypeParsed = "virtual"
      }

      //Parse grade level (ie, "6th-8th" -> "middle-school")
      gradeLevelRaw = el.getAttribute('gradeLevel')
      if (gradeLevelRaw.includes('10') || gradeLevelRaw.includes('11') || gradeLevelRaw.includes('12')) {
      	gradeLevelParsed = 'high-school'
      }
      else if (gradeLevelRaw.includes('6') || gradeLevelRaw.includes('7')) {
      	gradeLevelParsed = 'middle-school'
      }

      //Check that the checkbox conditions are met for each set of checkboxes
      var courseType = checked.courseType.length ? checked.courseType.includes(courseTypeParsed) : true;
      var subjectArea = checked.subjectArea.length ? checked.subjectArea.includes(el.getAttribute('subjectArea')) : true;
      var gradeLevel = checked.gradeLevel.length ? checked.gradeLevel.includes(gradeLevelParsed) : true;
      if (courseType && subjectArea && gradeLevel) {
        el.style.display = 'block';
      } else {
        el.style.display = 'none';
      }
    });
  }
</script>
